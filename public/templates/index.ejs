<%include all/head %>
<%include menu/header %>
<div class="wrapper user" id="userInfo">
    <input type="hidden" id="userId" value="<%=user.id%>" />
</div>

<div class="wrapper list" id="pageContent">

    <%include index/page %>
</div>

<%include all/foot %>

<script>

    function routeHtml(path) {
        $.get(path,  function(data) {
            $('#pageContent').html(data)
        })
    }

    function routeApi(href){

        $.get('/api/v1' + href, function (apiRes){

           // users
           var users = /^\/users\/\d$/;
           if(users.test(href)){
                $.get('/templ/account/userinfo.ejs',  function(templ) {
                    ejs.open = '{%';
                    ejs.close = '%}';
                    var templHtml = ejs.render(templ, { userInfo: apiRes.data });
                    $('#pageContent').html(templHtml)
                })
            }else if(/^\/articles\/\d$/.test(href)){
               console.log( apiRes.data)
               $.get('/templ/article/article.ejs',  function(templ) {
                   ejs.open = '{%';
                   ejs.close = '%}';
                   var templHtml = ejs.render(templ, { article: apiRes.data });
                   console.log(templHtml)
                   $('#pageContent').html(templHtml)
               })
           }else {
               window.location = '/'
           }


        })
    }

    $('body').on('click', 'a', function (e){
        e.preventDefault();

        var target = $(this).attr('href');

        switch (target){
            case '#register':
                routeHtml('/templ/account/register.ejs')
                break;
            case '#login':
                routeHtml('/templ/account/login.ejs')
                break;
            case '#':
                routeHtml('/templ/index/page.ejs')
                break;

            default :
                routeApi(target)
                break;
        }



        console.log($(this).attr('href'));
//        console.log(e.currentTarget);
    })

    var userId = $('#userId').val()

    if(userId  && userId != 'undefined'){

        $.get('/api/v1/users/' + userId, function (apiRes){
            $.get('/templ/account/users.ejs', function (templ){
                var templHtml = ejs.render(templ, { user: apiRes.data});
                $('#userInfo').html(templHtml)
            })
        })
    }else{
        $.get('/templ/account/users.ejs', function (templ){
            var templHtml = ejs.render(templ, { user: undefined});
            $('#userInfo').html(templHtml)
        })
    }


</script>